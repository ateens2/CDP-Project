# CDP-Project
2025-1 INHA CS Capstone Project

# CDP 프로젝트 - 탄소 감축 대시보드

## 📊 핵심 지표 계산 기준

### 1. 총 탄소 감축량 (kg CO₂e)

**계산 공식:**
```
각 판매 건별 탄소 감축량 = (판매 제품과 동일한 카테고리 기준 제품의 emmision_factor x weight_factor - 판매 제품의 emission_factor x weight_factor) x quantity
총 탄소 감축량 = Σ(각 판매 건별 탄소 감축량)
```

**조건:**
- 전체 기간의 판매 데이터 기준으로 계산
- 제품명 매칭이 성공한 판매 건만 포함

### 2. 나무 그루 수 (그루)

**계산 공식:**
```
나무 그루 수 = Math.round(총 탄소 감축량 / 22)
```

**기준:**
- 나무 1그루당 연간 22kg의 CO₂ 흡수
- 소수점 반올림 처리

### 3. 친환경 제품 판매율 (%)

- **친환경 제품:** weight_factor <= 0.6인 제품

**계산 방식:** 3가지 기준의 가중평균
- **건수 기준 (20%)**: 친환경 제품 판매 건수 / 전체 판매 건수
- **수량 기준 (40%)**: 친환경 제품 판매 수량 / 전체 판매 수량  
- **매출 기준 (40%)**: 친환경 제품 매출액 / 전체 매출액

**최종 공식:**
```
친환경 제품 판매율 = (건수비율 × 0.2) + (수량비율 × 0.4) + (매출비율 × 0.4)
```

### 4. 고객 환경 참여도 (%)

**분류 기준:**
- **기본 참여**: 1회 이상 친환경 제품 구매한 고객
- **활성 참여**: 3회 이상 친환경 제품 구매한 고객
- **헌신적 참여**: 전체 구매의 50% 이상이 친환경 제품인 고객

**표시 값:**
```
고객 환경 참여도 = (기본 참여 고객 비율 + 활성 참여 고객 비율 + 헌신적 참여 고객 비율) / 3
```

## 🗂️ 데이터 구조

### 제품_판매_기록 시트 (현재 구조)

| 컬럼 | 인덱스 | 필드명 | 설명 |
|------|--------|--------|------|
| A | 0 | 주문_번호 | 주문 고유 번호 |
| B | 1 | 주문자명 | 고객 이름 |
| C | 2 | 고객ID | 고객 고유 식별자 |
| D | 3 | 주문_일자 | 주문 날짜 |
| E | 4 | 상품명 | 구매한 제품명 |
| F | 5 | 카테고리 | 제품 카테고리 |
| G | 6 | 수량 | 구매 수량 |
| H | 7 | 총_주문_금액 | 총 주문 금액 |
| I | 8 | 결제방법 | 결제 수단 |

- 각 행의 상품명, 카테고리, 수량은 쉼표로 구분

### 고객_정보 시트 (현재 구조)

| 컬럼 | 인덱스 | 필드명 | 설명 |
|------|--------|--------|------|
| A | 0 | 고객ID | 고객 고유 식별자 |
| B | 1 | 고객명 | 고객 이름 |
| C | 2 | 이메일 | 고객 이메일 |
| D | 3 | 연락처 | 고객 연락처 |
| E | 4 | 주소 | 고객 주소 |
| F | 5 | 생년월일 | 고객 생년월일 |
| G | 6 | 성별 | 고객 성별 |
| H | 7 | 가입일 | 서비스 가입일 |
| I | 8 | 탄소_감축_등급 | 탄소 감축 등급 |

## 🔧 제품명 매칭 알고리즘

### 1단계: 정확 매칭
```javascript
normalizeProductName(carbonProduct) === normalizeProductName(saleProduct)
```

### 2단계: 키워드 매칭
```javascript
// 3글자 이상의 경우에만 포함 관계 확인
normalizedCarbonProduct.includes(normalizedSaleProduct) || 
normalizedSaleProduct.includes(normalizedCarbonProduct)
```

### 3단계: 카테고리 매칭
```javascript
// 판매 데이터의 카테고리 필드와 키워드 매핑
categoryKeywords = {
  '컵류': ['컵', 'cup', '텀블러', '머그'],
  '포장': ['포장', '봉투', 'bag', '박스'],
  '병류': ['병', '보틀', 'bottle', '물병'],
  '용기': ['용기', 'container', '도시락']
}
```

### 정규화 함수
```javascript
function normalizeProductName(name) {
  return name.toLowerCase()
    .replace(/\s+/g, '')           // 공백 제거
    .replace(/[()]/g, '')          // 괄호 제거
    .replace(/[0-9]+ml|[0-9]+g|[0-9]+개/g, ''); // 용량/수량 표기 제거
}
```

## ⚠️ 주의사항

1. **일관성 유지**: 모든 계산에서 동일한 친환경 기준(`weight_factor < 1.0`) 적용
2. **데이터 범위**: 총 탄소 감축량은 전체 기간, 친환경 제품 판매율은 올해 데이터 기준
3. **매칭률 모니터링**: 제품명 매칭 실패율이 높으면 알고리즘 개선 필요
4. **오류 처리**: 날짜 파싱 실패, 숫자 변환 오류 등에 대한 적절한 예외 처리

## 🐛 디버깅 체크리스트

- [ ] 제품명 매칭률이 80% 이상인가?
- [ ] 친환경 제품 판별 기준이 일관되게 적용되었는가?
- [ ] 날짜 범위가 올바르게 설정되었는가?
- [ ] 수치 계산에서 NaN이나 undefined가 발생하지 않는가?
